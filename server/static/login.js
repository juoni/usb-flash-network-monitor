// Generated by CoffeeScript 1.8.0
var handle_auth_result, make_login_request, prepare, showPassword;

showPassword = function() {
  var key_attr;
  key_attr = $("#key").attr("type");
  if (key_attr !== "text") {
    $(".checkbox").addClass("show");
    $("#key").attr("type", "text");
  } else {
    $(".checkbox").removeClass("show");
    $("#key").attr("type", "password");
  }
};

prepare = function() {
  var btn_login;
  btn_login = $("#btn-login");
  btn_login.click(make_login_request);
};

make_login_request = function() {
  var password, username;
  username = $("#email");
  password = $("#key");
  if (username.val().indexOf("@") < 0 && username.val() === "") {
    alert("Not valid email");
    return;
  }
  if (password.val() === "") {
    alert("Not valid password");
    return;
  }
  return $.ajax({
    url: '/login',
    type: 'POST',
    dataType: 'json',
    data: {
      username: username.val().trim(),
      password: password.val().trim()
    },
    success: handle_auth_result
  });
};

handle_auth_result = function(data) {
  var new_locatinon;
  if (data.result === "ok") {
    new_locatinon = document.location.protocol + '//' + document.location.host;
    window.location.href = new_locatinon;
  }
};

window.onload = prepare;
